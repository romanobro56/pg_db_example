## How to use the database:

1. Download all the dependencies

2. Migrate the prisma schema to postgres

```bash

npx prisma migrate --dev "<migration_name>"

```

3. import the package:


```json
{
    ...
  "dependencies": {
    "@middle/database": "*",
  },
  ...
}


```

4. import the library generated by npx prisma generate

```ts
import { prisma } from '@BugBounty/database'; // Your shared prisma client

```

5. Go hog wild

```ts

export async function registerUser(
  email: string,
  username: string,
  password: string
): Promise<IUser> {
  // 1) Check if user already exists
  const existing = await prisma.user.findFirst({
    where: {
      OR: [{ email }, { username }]
    }
  });
  if (existing) {
    throw new Error('Email or username already in use');
  }

  // 2) Hash the password
  const saltRounds = 10;
  const salt = await bcrypt.genSalt(saltRounds);
  const hashedPassword = await bcrypt.hash(password, salt);

  // 3) Create user in DB
  const newUser = await prisma.user.create({
    data: {
      email,
      username,
      password: hashedPassword,
      salt
    }
  });

  return newUser;
}

```

6. But probably, read the [prisma client docs](https://www.prisma.io/docs/orm/prisma-client) first

7. And if you need to add or remove things, read the [prisma schema docs](https://www.prisma.io/docs/orm/prisma-schema)


## How to deploy

### assuming you have a linux server to deploy to

1. Make sure your migrations are up to date

2. Make sure docker is installed on the server

```bash
sudo apt-get install -y docker.io
```

3. Build your image locally

```bash
docker-compose build 
```

4. Push your docker image to the github container repository
```bash
docker tag {{project_name}}-db-migrations:latest ghcr.io/{{gh_username}}/{{project_name}}-db-migrations:latest
docker push ghcr.io/{{gh_username}}/{{project_name}}-db-migrations:latest
```

5. Put the production docker compose on the server

```bash
scp -i "$SSH_KEY" \
    "$DOCKER_COMPOSE_FILE" \
    "$REMOTE_HOST:$REMOTE_PATH/docker-compose.yml"
```

6. Run the migrations and deploy the image on the vps

```bash

docker-compose pull
docker-compose up -d
docker-compose logs -f

```